<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Fast Track</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="theme-color" content="#020617">
  <meta name="apple-mobile-web-app-title" content="Fast Track">
  <meta name="application-name" content="Fast Track">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="manifest" href="site.webmanifest">
  <link rel="apple-touch-icon" href="assets/favicon/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon/favicon-16x16.png">
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { theme: { extend: { colors: { brand: { 500: "#06b6d4", 600: "#0891b2" }}}}};
  </script>
  <script src="firebase-config.js"></script>
</head>
<body class="min-h-screen bg-slate-950 text-slate-50">
  <div id="toast" class="fixed top-3 left-1/2 -translate-x-1/2 z-50 hidden px-3 py-2 rounded-full bg-slate-900 border border-slate-700 text-sm md:text-xs text-slate-100"></div>
  <div id="nav-tooltip" class="fixed z-50 hidden px-2 py-1 rounded-md bg-slate-900 border border-slate-700 text-[11px] text-slate-100 pointer-events-none shadow-lg"></div>

  <div id="auth-screen" class="min-h-screen hidden px-4 py-10 flex items-center justify-center">
    <div class="w-full max-w-md bg-slate-900/80 border border-slate-800 rounded-3xl p-6 md:p-5 shadow-xl">
      <div class="mb-5">
        <h2 id="auth-title" class="text-2xl md:text-xl font-semibold text-slate-50">Welcome back</h2>
        <p id="auth-subtitle" class="text-sm md:text-xs text-slate-400 mt-1">Sign in to keep your fasting history synced.</p>
      </div>

      <form id="auth-form" class="space-y-4">
        <div>
          <label for="auth-email" class="block text-sm md:text-xs text-slate-300 mb-1">Email</label>
          <input id="auth-email" type="email" autocomplete="email" required class="w-full bg-slate-950 border border-slate-700 rounded-xl px-3 py-3 md:py-2 text-sm md:text-xs text-slate-100 focus:outline-none focus:ring-1 focus:ring-brand-500">
        </div>
        <div>
          <label for="auth-password" class="block text-sm md:text-xs text-slate-300 mb-1">Password</label>
          <input id="auth-password" type="password" autocomplete="current-password" required class="w-full bg-slate-950 border border-slate-700 rounded-xl px-3 py-3 md:py-2 text-sm md:text-xs text-slate-100 focus:outline-none focus:ring-1 focus:ring-brand-500">
        </div>
        <label class="flex items-center gap-2 text-sm md:text-xs text-slate-300">
          <input id="auth-remember" type="checkbox" class="accent-cyan-400">
          Remember this device
        </label>
        <p class="text-xs md:text-[11px] text-slate-500">
          Remember keeps your encrypted data accessible on this device without ever storing a plaintext password.
        </p>

        <p id="auth-error" class="text-sm md:text-xs text-red-400 hidden"></p>

        <button id="auth-submit" type="submit" class="w-full py-3 md:py-2.5 rounded-xl bg-brand-500 text-slate-950 text-sm md:text-xs font-semibold">Sign in</button>
      </form>

      <div class="mt-4 text-sm md:text-xs text-slate-400 text-center">
        <span id="auth-toggle-text">New here?</span>
        <button id="auth-toggle" type="button" class="text-cyan-300 hover:text-cyan-200 font-medium ml-1">Create an account</button>
      </div>
    </div>
  </div>

  <div id="app" class="flex flex-col min-h-screen hidden">
    <header class="px-4 pt-4 pb-3 flex items-center justify-between">
      <div class="flex flex-col">
        <h1 class="text-xl md:text-lg font-semibold tracking-tight">Fast Track</h1>
        <p id="header-subtitle" class="text-sm md:text-xs text-slate-400">No active fast</p>
      </div>
      <button id="alerts-btn" class="text-sm md:text-xs px-3 py-2 md:py-1.5 rounded-full border border-slate-700 text-slate-200 flex items-center gap-2">
        <span id="alerts-dot" class="w-2 h-2 md:w-1.5 md:h-1.5 rounded-full bg-slate-600"></span>
        <span id="alerts-label">Enable alerts</span>
      </button>
    </header>

    <main class="flex-1 px-4 pb-28 md:pb-20 pt-2">
      <section id="tab-timer" class="h-full flex flex-col gap-6 md:gap-5">
        <div class="flex justify-center mt-2">
          <div class="w-full max-w-md">
            <!-- Bigger ring -->
            <div class="relative mx-auto w-[22rem] h-[22rem] md:w-[19rem] md:h-[19rem]">
              <svg viewBox="0 0 200 200" class="w-full h-full -rotate-90">
                <circle cx="100" cy="100" r="80" stroke="#1e293b" stroke-width="16" fill="none"></circle>
                <circle id="progress-ring" cx="100" cy="100" r="80" stroke="#06b6d4" stroke-width="16" stroke-linecap="round" fill="none" stroke-dasharray="502.6548245743669" stroke-dashoffset="502.6548245743669"></circle>
              </svg>

              <div class="absolute inset-0 flex flex-col items-center justify-center select-none">
                <div class="mb-3">
                  <div id="timer-type" class="text-sm md:text-xs text-cyan-100 px-3 py-1 md:px-2 md:py-0.5 rounded-full bg-cyan-600/25 border border-cyan-500/35">No fast selected</div>
                </div>

                <button id="timer-main" class="text-5xl md:text-4xl font-semibold tracking-tight px-3 py-2 rounded-2xl active:bg-slate-900/40">00:00:00</button>
                <div id="timer-mode" class="text-xs md:text-[11px] uppercase tracking-[0.2em] text-slate-500 mt-1">Time Fasted</div>
                <div id="timer-sub" class="text-sm md:text-xs text-slate-400 mt-2 md:mt-1">Tap time to change view</div>

                <div class="mt-4 md:mt-3">
                  <div id="timer-status" class="text-xs md:text-[11px] uppercase tracking-[0.2em] text-slate-500">IDLE</div>
                </div>
              </div>
            </div>

            <!-- Started / Target end row under ring -->
            <div class="mt-4 flex items-start justify-between gap-3 text-sm md:text-xs text-slate-400">
              <div class="flex flex-col">
                <div class="text-[11px] md:text-[10px] uppercase tracking-[0.2em] text-slate-500">Started</div>
                <button id="meta-start-btn" class="text-left text-slate-200 underline underline-offset-4 decoration-slate-700 disabled:opacity-50 disabled:no-underline disabled:cursor-not-allowed" disabled>—</button>
              </div>
              <div class="flex flex-col items-end">
                <div class="text-[11px] md:text-[10px] uppercase tracking-[0.2em] text-slate-500">Target end</div>
                <div id="meta-end" class="text-slate-200">—</div>
              </div>
            </div>

            <!-- Optional: planned duration small line -->
            <div class="mt-2 text-center text-xs md:text-[11px] text-slate-500">
              Planned duration: <span id="meta-planned" class="text-slate-300">—</span>
            </div>
          </div>
        </div>

        <div class="space-y-3">
          <button id="start-fast-btn" class="w-full py-4 md:py-3 rounded-full bg-brand-500 text-slate-950 font-semibold text-base md:text-sm">Start Fast</button>
          <button id="stop-fast-btn" class="w-full py-4 md:py-3 rounded-full bg-slate-800 text-slate-50 font-semibold text-base md:text-sm hidden">Stop Fast</button>
        </div>

        <div class="mt-1">
          <h2 class="text-xs uppercase tracking-[0.2em] text-slate-500 mb-2">Fast types</h2>
          <div id="fast-type-chips" class="flex flex-wrap gap-2"></div>
          <div class="text-xs md:text-[11px] text-slate-500 mt-2">Select a type to preview, then tap “Use this fast type” to apply.</div>
        </div>
      </section>

      <section id="tab-history" class="h-full flex-col gap-4 hidden">
        <div class="mb-4">
          <div class="flex items-center justify-between mb-2">
            <button id="calendar-prev" class="p-3 md:p-2 rounded-full bg-slate-900 border border-slate-700 text-sm md:text-xs">&lt;</button>
            <div id="calendar-label" class="text-base md:text-sm font-medium text-slate-100"></div>
            <button id="calendar-next" class="p-3 md:p-2 rounded-full bg-slate-900 border border-slate-700 text-sm md:text-xs">&gt;</button>
          </div>
          <div class="grid grid-cols-7 gap-1 text-[11px] md:text-[10px] text-center text-slate-500 mb-1">
            <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
          </div>
          <div id="calendar-grid" class="grid grid-cols-7 gap-1 text-sm md:text-xs"></div>
        </div>

        <div class="mb-3">
          <h2 class="text-xs uppercase tracking-[0.2em] text-slate-500 mb-1">Selected day</h2>
          <div id="day-summary" class="text-sm md:text-xs text-slate-300 mb-2 md:mb-1">No fasts logged</div>
          <div id="day-fast-list" class="space-y-2 text-sm md:text-xs"></div>
        </div>

        <div class="mb-3">
          <h2 class="text-xs uppercase tracking-[0.2em] text-slate-500 mb-1">Notes</h2>
          <div id="day-notes-summary" class="text-sm md:text-xs text-slate-300 mb-2 md:mb-1">No notes yet.</div>
          <div id="day-notes-list" class="space-y-2 text-sm md:text-xs"></div>
        </div>

        <div class="mt-2">
          <h2 class="text-xs uppercase tracking-[0.2em] text-slate-500 mb-1">Recent fasts</h2>
          <div id="recent-fast-list" class="space-y-2 text-sm md:text-xs"></div>
        </div>
      </section>

      <section id="tab-notes" class="h-full flex-col gap-4 hidden">
        <div class="space-y-3">
          <div>
            <h2 class="text-base md:text-sm font-medium text-slate-100">Notes</h2>
            <p class="text-sm md:text-xs text-slate-400">Capture reflections, cravings, or wins alongside your fasts.</p>
          </div>
          <button id="new-note-btn" class="w-full py-4 md:py-3 rounded-full bg-brand-500 text-slate-950 font-semibold text-base md:text-sm">New note</button>
        </div>

        <div id="notes-empty" class="note-empty hidden">
          <div id="notes-empty-title" class="text-slate-200 font-medium mb-1">No notes yet</div>
          <div id="notes-empty-body" class="text-sm md:text-xs text-slate-400">Start a new note to track how your fast feels.</div>
        </div>

        <div id="notes-list" class="space-y-3"></div>
      </section>

      <section id="tab-settings" class="h-full flex-col gap-4 hidden">
        <div class="space-y-3">
          <h2 class="text-xs uppercase tracking-[0.2em] text-slate-500 mb-1">Defaults</h2>
          <div>
            <label class="block text-sm md:text-xs text-slate-300 mb-1">Default fast type</label>
            <select id="default-fast-select" class="w-full bg-slate-900 border border-slate-700 rounded-xl px-3 py-3 md:py-2 text-sm md:text-xs focus:outline-none focus:ring-1 focus:ring-brand-500"></select>
          </div>
        </div>

        <div class="mt-4 space-y-3">
          <h2 class="text-xs uppercase tracking-[0.2em] text-slate-500 mb-1">Alerts</h2>
          <label class="flex items-center justify-between text-sm md:text-xs">
            <span class="text-slate-300">Alert when fast ends</span>
            <button id="toggle-end-alert" class="switch-btn"></button>
          </label>
          <label class="flex items-center justify-between text-sm md:text-xs">
            <span class="text-slate-300">Hourly reminder after end</span>
            <button id="toggle-hourly-alert" class="switch-btn"></button>
          </label>
          <p class="text-xs md:text-[11px] text-slate-500">For best reliability, install the app (Add to Home Screen). Web alerts depend on OS/browser power rules.</p>
        </div>

        <div class="mt-4 space-y-3">
          <h2 class="text-xs uppercase tracking-[0.2em] text-slate-500 mb-1">Data</h2>
          <button id="export-data" class="w-full py-3 md:py-2.5 rounded-xl bg-slate-900 border border-slate-700 text-sm md:text-xs font-medium">Export history (CSV)</button>
          <button id="clear-data" class="w-full py-3 md:py-2.5 rounded-xl bg-red-600 text-slate-50 text-sm md:text-xs font-medium">Clear all data</button>
        </div>

        <div class="mt-4 space-y-3">
          <h2 class="text-xs uppercase tracking-[0.2em] text-slate-500 mb-1">Account</h2>
          <button id="sign-out" class="w-full py-3 md:py-2.5 rounded-xl bg-slate-900 border border-slate-700 text-sm md:text-xs font-medium">Sign out</button>
        </div>
      </section>
    </main>

    <nav class="fixed bottom-0 inset-x-0 border-t border-slate-800 bg-slate-950/95 backdrop-blur pb-[env(safe-area-inset-bottom)]">
      <div class="flex h-20 md:h-14">
        <button data-tab="timer" data-label="Timer" class="nav-btn flex-1 flex items-center justify-center text-slate-100 nav-btn-active">
          <div class="flex flex-col md:flex-row items-center justify-center gap-1 md:gap-2">
            <svg class="w-7 h-7 md:w-5 md:h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="13" r="9"></circle>
              <path d="M12 10v3l2 2"></path>
              <path d="M9 2h6"></path>
            </svg>
            <span class="hidden md:inline text-xs">Timer</span>
          </div>
        </button>

        <button data-tab="history" data-label="History" class="nav-btn flex-1 flex items-center justify-center text-slate-500">
          <div class="flex flex-col md:flex-row items-center justify-center gap-1 md:gap-2">
            <svg class="w-7 h-7 md:w-5 md:h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M3 3v5h5"></path>
              <path d="M3.05 13a9 9 0 1 0 .5-4"></path>
              <path d="M12 7v5l4 2"></path>
            </svg>
            <span class="hidden md:inline text-xs">History</span>
          </div>
        </button>

        <button data-tab="notes" data-label="Notes" class="nav-btn flex-1 flex items-center justify-center text-slate-500">
          <div class="flex flex-col md:flex-row items-center justify-center gap-1 md:gap-2">
            <svg class="w-7 h-7 md:w-5 md:h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M4 4h11a2 2 0 0 1 2 2v12"></path>
              <path d="M8 4v16a2 2 0 0 0 2 2h10"></path>
              <path d="M12 11h6"></path>
              <path d="M12 15h6"></path>
            </svg>
            <span class="hidden md:inline text-xs">Notes</span>
          </div>
        </button>

        <button data-tab="settings" data-label="Settings" class="nav-btn flex-1 flex items-center justify-center text-slate-500">
          <div class="flex flex-col md:flex-row items-center justify-center gap-1 md:gap-2">
            <svg class="w-7 h-7 md:w-5 md:h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Z"></path>
              <path d="M19.4 15a1.8 1.8 0 0 0 .36 1.98l.06.06a2.2 2.2 0 1 1-3.11 3.11l-.06-.06A1.8 1.8 0 0 0 15 19.4a1.8 1.8 0 0 0-1 .33 1.8 1.8 0 0 0-.9 1.57V21a2.2 2.2 0 1 1-4.4 0v-.1a1.8 1.8 0 0 0-.9-1.57 1.8 1.8 0 0 0-1-.33 1.8 1.8 0 0 0-1.98.36l-.06.06a2.2 2.2 0 1 1-3.11-3.11l.06-.06A1.8 1.8 0 0 0 4.6 15a1.8 1.8 0 0 0-.33-1 1.8 1.8 0 0 0-1.57-.9H2.6a2.2 2.2 0 1 1 0-4.4h.1a1.8 1.8 0 0 0 1.57-.9 1.8 1.8 0 0 0 .33-1A1.8 1.8 0 0 0 4.24 4.82l-.06-.06A2.2 2.2 0 1 1 7.3 1.65l.06.06A1.8 1.8 0 0 0 9 2.6c.33 0 .67-.11 1-.33A1.8 1.8 0 0 0 10.9.7V.6a2.2 2.2 0 1 1 4.4 0v.1a1.8 1.8 0 0 0 .9 1.57c.33.22.67.33 1 .33a1.8 1.8 0 0 0 1.98-.36l.06-.06a2.2 2.2 0 1 1 3.11 3.11l-.06.06A1.8 1.8 0 0 0 19.4 9c0 .33.11.67.33 1 .22.33.57.67.9.9h.1a2.2 2.2 0 1 1 0 4.4h-.1a1.8 1.8 0 0 0-1.57.9c-.22.33-.33.67-.33 1Z"></path>
            </svg>
            <span class="hidden md:inline text-xs">Settings</span>
          </div>
        </button>
      </div>
    </nav>
  </div>

  <div id="fast-type-modal" class="fixed inset-0 z-30 hidden">
    <div class="absolute inset-0 bg-black/50"></div>
    <div class="absolute inset-x-0 bottom-0 rounded-t-3xl bg-slate-950 border-t border-slate-800 p-4 max-h-[65vh] overflow-y-auto">
      <div class="flex items-center justify-between mb-2">
        <div>
          <div id="modal-type-label" class="text-base md:text-sm font-medium text-slate-50"></div>
          <div id="modal-type-duration" class="text-xs md:text-[11px] text-slate-400"></div>
        </div>
        <button id="modal-close" class="text-sm md:text-xs px-3 py-2 md:px-2 md:py-1 rounded-full bg-slate-900 border border-slate-700">Close</button>
      </div>
      <ul id="modal-bullets" class="list-disc list-inside text-sm md:text-xs text-slate-300 space-y-1 mb-3"></ul>
      <button id="modal-use-type" class="w-full py-3 md:py-2.5 rounded-full bg-brand-500 text-slate-950 text-sm md:text-xs font-semibold">Use this fast type</button>
    </div>
  </div>

  <div id="edit-start-modal" class="fixed inset-0 z-40 hidden">
    <div class="absolute inset-0 bg-black/50"></div>
    <div class="absolute inset-x-0 bottom-0 rounded-t-3xl bg-slate-950 border-t border-slate-800 p-4">
      <div class="flex items-center justify-between mb-3">
        <div class="text-base md:text-sm font-medium text-slate-50">Edit start time</div>
        <button id="edit-start-close" class="text-sm md:text-xs px-3 py-2 md:px-2 md:py-1 rounded-full bg-slate-900 border border-slate-700">Close</button>
      </div>
      <label class="block text-sm md:text-xs text-slate-300 mb-1">Start time</label>
      <input id="edit-start-input" type="datetime-local" class="w-full bg-slate-900 border border-slate-700 rounded-xl px-3 py-3 md:py-2 text-sm md:text-xs focus:outline-none focus:ring-1 focus:ring-brand-500">
      <div class="flex gap-2 mt-3">
        <button id="edit-start-now" class="flex-1 py-3 md:py-2.5 rounded-xl bg-slate-900 border border-slate-700 text-sm md:text-xs font-medium">Set to now</button>
        <button id="edit-start-save" class="flex-1 py-3 md:py-2.5 rounded-xl bg-brand-500 text-slate-950 text-sm md:text-xs font-semibold">Save</button>
      </div>
      <div class="text-xs md:text-[11px] text-slate-500 mt-2">End time updates automatically to keep the planned duration.</div>
    </div>
  </div>

  <div id="note-editor-modal" class="fixed inset-0 z-40 hidden">
    <div class="absolute inset-0 bg-black/50"></div>
    <div class="absolute inset-x-0 bottom-0 rounded-t-3xl bg-slate-950 border-t border-slate-800 p-4">
      <div class="flex items-center justify-between mb-3">
        <div class="text-base md:text-sm font-medium text-slate-50">Note</div>
        <button id="note-editor-close" class="text-sm md:text-xs px-3 py-2 md:px-2 md:py-1 rounded-full bg-slate-900 border border-slate-700">Close</button>
      </div>
      <div class="flex flex-wrap items-center gap-2 mb-3">
        <span id="note-editor-fast" class="note-badge"></span>
        <span id="note-editor-date" class="text-xs md:text-[11px] text-slate-400"></span>
      </div>
      <label for="note-editor-content" class="block text-sm md:text-xs text-slate-300 mb-1">Note content</label>
      <textarea id="note-editor-content" rows="5" class="w-full bg-slate-900 border border-slate-700 rounded-xl px-3 py-3 md:py-2 text-sm md:text-xs focus:outline-none focus:ring-1 focus:ring-brand-500" placeholder="What do you want to remember?"></textarea>
      <div class="flex gap-2 mt-3">
        <button id="note-editor-delete" class="flex-1 py-3 md:py-2.5 rounded-xl bg-slate-900 border border-slate-700 text-sm md:text-xs font-medium text-red-300 hidden">Delete</button>
        <button id="note-editor-save" class="flex-1 py-3 md:py-2.5 rounded-xl bg-brand-500 text-slate-950 text-sm md:text-xs font-semibold">Save note</button>
      </div>
    </div>
  </div>

  <script src="script.js" type="module"></script>
</body>
</html>
